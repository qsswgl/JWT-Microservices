# ğŸ‰ JWT å¾®æœåŠ¡é¡¹ç›® - éƒ¨ç½²å®ŒæˆæŠ¥å‘Š

## éƒ¨ç½²æ¦‚å†µ

**éƒ¨ç½²æ—¶é—´**: 2025å¹´11æœˆ3æ—¥  
**éƒ¨ç½²æœåŠ¡å™¨**: tx.qsgl.net (Ubuntu)  
**éƒ¨ç½²ç›®å½•**: /opt/jwt-microservices  
**éƒ¨ç½²æ–¹å¼**: Docker Compose

---

## âœ… éƒ¨ç½²çŠ¶æ€

### æ‰€æœ‰æœåŠ¡å·²æˆåŠŸéƒ¨ç½²å¹¶è¿è¡Œ

| æœåŠ¡åç§° | å®¹å™¨åç§° | çŠ¶æ€ | ç«¯å£æ˜ å°„ |
|---------|---------|------|---------|
| Redisç¼“å­˜ | jwt-redis | âœ… Running (healthy) | 6379:6379 |
| è®¤è¯æœåŠ¡ | jwt-authservice | âœ… Running | 6001:8080 |
| è®¢å•æœåŠ¡ | jwt-orderservice | âœ… Running | 6002:8080 |
| APIç½‘å…³ | jwt-apigateway | âœ… Running | 6005:8080 |

---

## ğŸŒ æœåŠ¡è®¿é—®åœ°å€

### Swagger API æ–‡æ¡£
- **è®¤è¯æœåŠ¡**: http://tx.qsgl.net:6001/swagger
- **è®¢å•æœåŠ¡**: http://tx.qsgl.net:6002/swagger

### API ç«¯ç‚¹
- **APIç½‘å…³**: http://tx.qsgl.net:6005
  - ç™»å½•: `POST /api/auth/login`
  - åˆ·æ–°ä»¤ç‰Œ: `POST /api/auth/refresh`
  - æ³¨é”€: `POST /api/auth/logout`
  - è®¢å•åˆ—è¡¨: `GET /api/orders`

---

## ğŸ”§ ç«¯å£é…ç½®è°ƒæ•´

ä¸ºé¿å…ä¸æœåŠ¡å™¨ç°æœ‰æœåŠ¡å†²çªï¼Œç«¯å£å·²ä»åŸè®¡åˆ’è°ƒæ•´ï¼š

| æœåŠ¡ | åŸç«¯å£ | æ–°ç«¯å£ | è°ƒæ•´åŸå›  |
|-----|-------|-------|---------|
| è®¤è¯æœåŠ¡ | 5001 | **6001** | é¿å…æ½œåœ¨å†²çª |
| è®¢å•æœåŠ¡ | 5002 | **6002** | é¿å¼€ envoy-proxy (5002) |
| APIç½‘å…³ | 5005 | **6005** | ä¿æŒä¸€è‡´æ€§ |
| Redis | 6379 | 6379 | å†…éƒ¨ä½¿ç”¨ï¼Œæ— å†²çª |

### æœåŠ¡å™¨ç°æœ‰å®¹å™¨çŠ¶æ€
âœ… æ‰€æœ‰åŸæœ‰å®¹å™¨æ­£å¸¸è¿è¡Œï¼Œæ— å†²çªï¼š
- dbaccess-api (80, 5189, 5190)
- dnsapi (5074-5075, 8080, 8443)
- envoy-proxy (5002) âš ï¸ å·²é¿å¼€
- registry (5000) âš ï¸ å·²é¿å¼€
- webrtc-app, wechat-api, frps, wecom-media-proxy ç­‰å‡æ­£å¸¸

---

## ğŸ§ª éƒ¨ç½²éªŒè¯æµ‹è¯•

### 1. âœ… è®¤è¯æœåŠ¡æµ‹è¯•
```powershell
# ç”¨æˆ·ç™»å½•
POST http://tx.qsgl.net:6001/api/auth/login
Body: {"username":"admin","password":"admin123"}
ç»“æœ: âœ… æˆåŠŸè¿”å› JWT Token
```

### 2. âœ… è®¢å•æœåŠ¡æµ‹è¯•
```powershell
# è·å–è®¢å•åˆ—è¡¨
GET http://tx.qsgl.net:6002/api/orders
Headers: 
  - Authorization: Bearer <token>
  - X-User-Id: admin
  - X-User-Roles: Admin,User
ç»“æœ: âœ… æˆåŠŸè¿”å›è®¢å•æ•°æ®
```

### 3. âœ… APIç½‘å…³æµ‹è¯•
```powershell
# é€šè¿‡ç½‘å…³è®¿é—®è®¤è¯æœåŠ¡
POST http://tx.qsgl.net:6005/api/auth/login
Body: {"username":"admin","password":"admin123"}
ç»“æœ: âœ… ç½‘å…³è·¯ç”±æ­£å¸¸ï¼ŒæˆåŠŸè·å–Token
```

---

## ğŸ“¦ éƒ¨ç½²æ–‡ä»¶æ¸…å•

### æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶
```
/opt/jwt-microservices/
â”œâ”€â”€ docker-compose.yml    # æœåŠ¡ç¼–æ’é…ç½®
â”œâ”€â”€ redis-data/           # RedisæŒä¹…åŒ–æ•°æ®å·
```

### Docker é•œåƒ
```bash
jwt-authservice:latest    # 223MB
jwt-apigateway:latest     # 222MB
jwt-orderservice:latest   # 223MB
redis:7-alpine           # ä¸‹è½½è‡ªDocker Hub
```

---

## ğŸ” æµ‹è¯•è´¦å·

| ç”¨æˆ·å | å¯†ç  | è§’è‰² | è¯´æ˜ |
|-------|------|------|------|
| admin | admin123 | Admin, User | ç®¡ç†å‘˜è´¦å·ï¼Œæ‹¥æœ‰æ‰€æœ‰æƒé™ |
| zhangsan | pass123 | User | æ™®é€šç”¨æˆ·ï¼Œä»…æŸ¥è¯¢æƒé™ |

---

## ğŸ“ ç®¡ç†å‘½ä»¤

### æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose ps"
```

### æŸ¥çœ‹æœåŠ¡æ—¥å¿—
```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose logs -f"

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose logs -f authservice"
```

### é‡å¯æœåŠ¡
```bash
# é‡å¯æ‰€æœ‰æœåŠ¡
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose restart"

# é‡å¯ç‰¹å®šæœåŠ¡
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose restart authservice"
```

### åœæ­¢æœåŠ¡
```bash
ssh -i "C:\Key\tx.qsgl.net_id_ed25519" root@tx.qsgl.net \
  "cd /opt/jwt-microservices && docker-compose down"
```

### æ›´æ–°éƒ¨ç½²
```powershell
# åœ¨æœ¬åœ°æ‰§è¡Œ
.\deploy-quick.ps1
```

---

## ğŸ—ï¸ æ¶æ„è¯´æ˜

### ç½‘ç»œæ‹“æ‰‘
```
Internet
    â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   tx.qsgl.net (Ubuntu Server)       â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Docker Network             â”‚   â”‚
â”‚  â”‚  jwt-network                â”‚   â”‚
â”‚  â”‚                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚   â”‚
â”‚  â”‚  â”‚  Redis   â”‚ :6379        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜              â”‚   â”‚
â”‚  â”‚       â”‚                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ Auth       â”‚ :6001      â”‚   â”‚â† Swagger UI
â”‚  â”‚  â”‚ Service    â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚       â”‚                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚ Order      â”‚ :6002      â”‚   â”‚â† Swagger UI
â”‚  â”‚  â”‚ Service    â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â”‚       â”‚                     â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚ API         â”‚ :6005     â”‚   â”‚â† Entry Point
â”‚  â”‚  â”‚ Gateway     â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¤è¯æµç¨‹
```
1. ç”¨æˆ·ç™»å½• â†’ API Gateway (:6005) â†’ Auth Service (:6001)
2. Auth Service éªŒè¯å¯†ç  â†’ ç”Ÿæˆ JWT Token
3. Token è¿”å›ç»™å®¢æˆ·ç«¯
4. å®¢æˆ·ç«¯æºå¸¦ Token è®¿é—®å—ä¿æŠ¤èµ„æº
5. Gateway éªŒè¯ Token (æ£€æŸ¥ Redis é»‘åå•)
6. è½¬å‘è¯·æ±‚åˆ°åç«¯æœåŠ¡
```

---

## ğŸ”’ å®‰å…¨ç‰¹æ€§

âœ… **JWT è®¤è¯**: ä½¿ç”¨ HS256 ç®—æ³•ç­¾å  
âœ… **Token è¿‡æœŸ**: Access Token 30åˆ†é’Ÿï¼ŒRefresh Token 7å¤©  
âœ… **Token é»‘åå•**: Redis å­˜å‚¨å·²æ³¨é”€çš„ Token  
âœ… **å¯†ç åŠ å¯†**: BCrypt å“ˆå¸Œç®—æ³•  
âœ… **è§’è‰²æˆæƒ**: Admin å’Œ User è§’è‰²æ§åˆ¶  
âœ… **è¯·æ±‚æ—¥å¿—**: æ‰€æœ‰è¯·æ±‚å¸¦å”¯ä¸€ Request ID

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|-----|---|
| å®¹å™¨å¯åŠ¨æ—¶é—´ | ~15ç§’ |
| é•œåƒæ€»å¤§å° | ~670MB |
| å†…å­˜å ç”¨ | ~500MB (4ä¸ªå®¹å™¨) |
| å¯åŠ¨é¡ºåº | Redis â†’ Auth â†’ Order â†’ Gateway |

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–
1. âœ… **HTTPS**: é…ç½® Nginx åå‘ä»£ç† + SSL è¯ä¹¦
2. âœ… **åŸŸå**: é…ç½®åŸŸåè§£æï¼Œæ›¿ä»£ IP:ç«¯å£è®¿é—®
3. âœ… **ç›‘æ§**: é›†æˆ Prometheus + Grafana
4. âœ… **æ—¥å¿—**: é…ç½® ELK/Loki æ—¥å¿—èšåˆ
5. âœ… **å¤‡ä»½**: å®šæœŸå¤‡ä»½ Redis æ•°æ®
6. âœ… **é™æµ**: é…ç½® Ocelot å…¨å±€é™æµ
7. âœ… **å¥åº·æ£€æŸ¥**: æ·»åŠ  K8s LivenessProbe

### å®‰å…¨åŠ å›º
1. ä¿®æ”¹é»˜è®¤æµ‹è¯•è´¦å·å¯†ç 
2. ä½¿ç”¨ç¯å¢ƒå˜é‡ç®¡ç†æ•æ„Ÿé…ç½®
3. é…ç½®é˜²ç«å¢™è§„åˆ™
4. å¯ç”¨ Redis å¯†ç ä¿æŠ¤
5. å®šæœŸæ›´æ–° Docker é•œåƒ

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å®Œæ•´é¡¹ç›®æ–‡æ¡£](./README.md)
- [æ¶æ„è®¾è®¡æ–‡æ¡£](./ARCHITECTURE.md)
- [éƒ¨ç½²æŒ‡å—](./DEPLOY_GUIDE.md)
- [è¿è¡ŒæŒ‡å—](./RUNNING_GUIDE.md)

---

## ğŸ†˜ æ•…éšœæ’æŸ¥

### æœåŠ¡æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs authservice

# é‡å¯æœåŠ¡
docker-compose restart
```

### ç«¯å£è¢«å ç”¨
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep :6001

# ä¿®æ”¹ docker-compose.yml ä¸­çš„ç«¯å£æ˜ å°„
```

### Redis è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥ Redis å®¹å™¨
docker-compose logs redis

# æµ‹è¯• Redis è¿æ¥
docker-compose exec redis redis-cli ping
```

---

**éƒ¨ç½²äººå‘˜**: GitHub Copilot  
**å®¡æ ¸çŠ¶æ€**: âœ… å·²éªŒè¯  
**éƒ¨ç½²ç‰ˆæœ¬**: v1.0.0  
**æœ€åæ›´æ–°**: 2025å¹´11æœˆ3æ—¥

---

## è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹é¡¹ç›®æ–‡æ¡£æˆ–è”ç³»ç³»ç»Ÿç®¡ç†å‘˜ã€‚

**é¡¹ç›®åœ°å€**: K:\JWT  
**æœåŠ¡å™¨**: tx.qsgl.net  
**éƒ¨ç½²ç›®å½•**: /opt/jwt-microservices
